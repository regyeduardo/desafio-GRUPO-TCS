{% extends 'base.html' %}
{% block title %} Dashboard {% endblock %}

{% block style %}
<!-- <style>
.form-control {
  padding-right: 30px;
}

.form-control + .fas {
  position: absolute;
  right: 0;
  padding: 8px 27px;
} -->
</style>
{% endblock %}

{% block body %}
<h1>Usuario logado</h1>

<a href="{% url 'login:logout' %}">LOGOUT</a>

<div class="container">
    <div class="row">
        <div class="col-sm">
            <h2>Status</h2>
            <button type="button" class="btn btn-primary">Criar Status</button>
            <div class="card">
                <div class="card-body">
                    <form action="" method="post">
                        <div class="row" id="Status">
                            <div class="col">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="status_codigo" curValue="772634" value="772634" disabled>
                                    <span class="input-group-append">
                                        <i class="input-group-text bi bi-pencil-square"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="col">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="status_nome" value="Funcionando" disabled>
                                    <span class="input-group-append">
                                        <i class="input-group-text bi bi-pencil-square"></i>
                                    </span>
                                </div>
                            </div>
                            <!-- <div class="col">
                                <button type="button" class="btn btn-success botao-enviar">Enviar</button>
                            </div> -->
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
      
</div>
<script>
    const insertRemoveSubmitButton = (col) => {
        const formControls = Array.prototype.slice.call(col.querySelectorAll(".form-control"))

        const insertSubmitButton = formControls.every((formControl) => {
            return (formControl.value == formControl.curValue)
        })

        console.log(insertSubmitButton)

        if (insertSubmitButton) {
            const div = document.createElement("div")
            div.setAttribute("class", "col")
            div.innerHTML = `
             <button type="button" class="btn btn-success botao-enviar">
                Enviar
            </button>
            `
            document.querySelector("#Status").append(div)
        }
    }

    let elements = document.getElementsByClassName("form-control")

    for (let item of elements) {
        const icon = item.nextElementSibling.children[0]

        icon.addEventListener("click", (e) => {
            item.removeAttribute("disabled")
            item.focus()
            item.setAttribute("required", "")
            icon.removeEventListener('click', () => {})
            icon.parentElement.remove()
            const parent = item.parentElement
            const col = parent.parentElement.parentElement

            item.addEventListener('focusout', (ev) => {
                if (ev.currentTarget.value == item.getAttribute("value")) {
                    if (!parent.querySelector("span")) {
                        item.setAttribute("disabled", "")
                        let span = document.createElement("SPAN")
                        span.setAttribute("class", "input-group-append")
                        span.appendChild(icon)
                        item.parentElement.appendChild(span)

                        insertRemoveSubmitButton(col)

                        item.removeEventListener('click', () => { })
                    } else {
                        insertRemoveSubmitButton(col)
                    }
                } 
            })
        })
    }
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
{% endblock %}